<!DOCTYPE html>
<html class="light" lang="pt-BR">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Cadastro - Pagina do Optometrista</title>
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap"
        rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#13ecec",
                        "primary-dark": "#0ebdbd",
                        "background-light": "#f6f8f8",
                        "background-dark": "#102222",
                        "text-main": "#0d1b1b",
                        "text-secondary": "#4c9a9a",
                        "border-color": "#cfe7e7",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.5rem",
                        "lg": "1rem",
                        "xl": "1.5rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
    <style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
            font-size: 20px;
        }

        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>

<body
    class="bg-background-light dark:bg-background-dark text-text-main dark:text-white antialiased transition-colors duration-200">
    <div class="relative flex h-auto min-h-screen w-full flex-col overflow-x-hidden">
        <header
            class="flex items-center justify-between whitespace-nowrap border-b border-solid border-border-color bg-white/80 dark:bg-background-dark/80 backdrop-blur-sm px-6 py-4 lg:px-40 sticky top-0 z-50">
            <div class="flex items-center gap-4 text-text-main dark:text-white">
                <div class="size-8 flex items-center justify-center text-primary">
                    <svg class="w-full h-full" fill="none" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
                        <g clip-path="url(#clip0_6_319)">
                            <path
                                d="M8.57829 8.57829C5.52816 11.6284 3.451 15.5145 2.60947 19.7452C1.76794 23.9758 2.19984 28.361 3.85056 32.3462C5.50128 36.3314 8.29667 39.7376 11.8832 42.134C15.4698 44.5305 19.6865 45.8096 24 45.8096C28.3135 45.8096 32.5302 44.5305 36.1168 42.134C39.7033 39.7375 42.4987 36.3314 44.1494 32.3462C45.8002 28.361 46.2321 23.9758 45.3905 19.7452C44.549 15.5145 42.4718 11.6284 39.4217 8.57829L24 24L8.57829 8.57829Z"
                                fill="currentColor"></path>
                        </g>
                        <defs>
                            <clipPath id="clip0_6_319">
                                <rect fill="white" height="48" width="48"></rect>
                            </clipPath>
                        </defs>
                    </svg>
                </div>
                <h2 class="text-lg font-bold leading-tight tracking-[-0.015em]">Pagina do Optometrista</h2>
            </div>
            <div class="hidden sm:flex items-center gap-4">
                <span class="text-sm font-medium text-text-secondary">Já¡ possui uma conta?</span>
                <a href="Login - Pagina Inicial.html"
                    class="flex cursor-pointer items-center justify-center overflow-hidden rounded-xl h-10 px-6 bg-transparent border border-border-color hover:bg-slate-50 text-text-main dark:text-white text-sm font-bold leading-normal tracking-[0.015em] transition-colors">
                    <span class="truncate">Entrar</span>
                </a>
            </div>
        </header>
        <main class="flex-1 flex flex-col items-center justify-center py-10 px-4 sm:px-6">
            <div class="w-full max-w-[580px] flex flex-col gap-6">
                <div class="flex flex-col gap-3">
                    <div class="flex gap-6 justify-between items-end">
                        <p class="text-text-main dark:text-white text-base font-bold leading-normal">Passo 1 de 2</p>
                        <span class="text-xs font-semibold text-primary uppercase tracking-wider">Cadastro
                            Inicial</span>
                    </div>
                    <div class="rounded-full bg-[#cfe7e7] dark:bg-gray-700 h-2 overflow-hidden">
                        <div class="h-full rounded-full bg-primary transition-all duration-500 ease-out"
                            style="width: 50%;"></div>
                    </div>
                    <p class="text-text-secondary text-sm font-normal leading-normal">Dados Pessoais e Profissionais</p>
                </div>
                <div
                    class="bg-white dark:bg-[#1a2c2c] rounded-2xl shadow-sm border border-border-color/50 p-6 sm:p-10 flex flex-col gap-6">
                    <div class="text-center sm:text-left">
                        <h1
                            class="text-text-main dark:text-white tracking-tight text-[28px] sm:text-[32px] font-bold leading-tight mb-2">
                            Bem-vindo, Doutor(a)
                        </h1>
                        <p class="text-text-secondary text-base font-normal leading-relaxed">
                            Insira seus dados profissionais abaixo para iniciar o gerenciamento inteligente da sua
                            clá­nica.
                        </p>
                    </div>
                    <form id="signup-form" class="flex flex-col gap-5">
                        <div class="flex flex-col gap-2">
                            <label class="text-text-main dark:text-gray-200 text-sm font-medium leading-normal"
                                for="name">Nome Completo</label>
                            <div class="relative group">
                                <div
                                    class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-text-secondary group-focus-within:text-primary transition-colors">
                                    <span class="material-symbols-outlined">person</span>
                                </div>
                                <input
                                    class="w-full rounded-xl text-text-main dark:text-white border border-border-color bg-background-light dark:bg-background-dark focus:border-primary focus:ring-1 focus:ring-primary h-12 pl-12 pr-4 text-base placeholder:text-text-secondary/60 transition-all outline-none"
                                    id="name" placeholder="Dr. Joáo Silva" type="text" required />
                            </div>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-5">
                            <div class="flex flex-col gap-2">
                                <label class="text-text-main dark:text-gray-200 text-sm font-medium leading-normal"
                                    for="cr">Registro (CBOO)</label>
                                <div class="relative group">
                                    <div
                                        class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-text-secondary group-focus-within:text-primary transition-colors">
                                        <span class="material-symbols-outlined">badge</span>
                                    </div>
                                    <input
                                        class="w-full rounded-xl text-text-main dark:text-white border border-border-color bg-background-light dark:bg-background-dark focus:border-primary focus:ring-1 focus:ring-primary h-12 pl-12 pr-4 text-base placeholder:text-text-secondary/60 transition-all outline-none"
                                        id="cr" placeholder="0000-UF" type="text" />
                                </div>
                            </div>
                            <div class="flex flex-col gap-2">
                                <label class="text-text-main dark:text-gray-200 text-sm font-medium leading-normal"
                                    for="email">E-mail Profissional</label>
                                <div class="relative group">
                                    <div
                                        class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-text-secondary group-focus-within:text-primary transition-colors">
                                        <span class="material-symbols-outlined">mail</span>
                                    </div>
                                    <input
                                        class="w-full rounded-xl text-text-main dark:text-white border border-border-color bg-background-light dark:bg-background-dark focus:border-primary focus:ring-1 focus:ring-primary h-12 pl-12 pr-4 text-base placeholder:text-text-secondary/60 transition-all outline-none"
                                        id="email" placeholder="doutor@clinica.com" type="email" required />
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col gap-2">
                            <label class="text-text-main dark:text-gray-200 text-sm font-medium leading-normal"
                                for="password">Senha</label>
                            <div class="relative group">
                                <div
                                    class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-text-secondary group-focus-within:text-primary transition-colors">
                                    <span class="material-symbols-outlined">lock</span>
                                </div>
                                <input
                                    class="w-full rounded-xl text-text-main dark:text-white border border-border-color bg-background-light dark:bg-background-dark focus:border-primary focus:ring-1 focus:ring-primary h-12 pl-12 pr-12 text-base placeholder:text-text-secondary/60 transition-all outline-none"
                                    id="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" type="password" required />
                                <button
                                    class="absolute inset-y-0 right-0 pr-4 flex items-center text-text-secondary hover:text-text-main cursor-pointer"
                                    type="button"
                                    onclick="const p = document.getElementById('password'); p.type = p.type === 'password' ? 'text' : 'password'">
                                    <span class="material-symbols-outlined">visibility</span>
                                </button>
                            </div>
                            <p class="text-xs text-text-secondary mt-1 ml-1 flex items-center gap-1">
                                <span class="material-symbols-outlined !text-[14px]">info</span>
                                Má­nimo de 8 caracteres
                            </p>
                        </div>
                        <div class="pt-4">
                            <button id="submit-btn"
                                class="w-full cursor-pointer flex items-center justify-center overflow-hidden rounded-xl h-12 px-6 bg-primary hover:bg-primary-dark text-text-main font-bold text-base leading-normal tracking-[0.015em] transition-all shadow-md hover:shadow-lg transform active:scale-[0.99]"
                                type="submit">
                                <span class="truncate" id="btn-text">Criar Conta e Continuar</span>
                                <span class="material-symbols-outlined ml-2">arrow_forward</span>
                            </button>
                        </div>
                    </form>
                    <div id="error-msg" class="hidden mt-4 p-3 bg-red-100 text-red-700 rounded-lg text-sm text-center">
                    </div>

                    <script type="module">
                        import { supabase } from './js/supabase-client.js';

                        const form = document.getElementById('signup-form');
                        const errorDiv = document.getElementById('error-msg');
                        const btnText = document.getElementById('btn-text');
                        const btn = document.getElementById('submit-btn');

                        form.addEventListener('submit', async (e) => {
                            e.preventDefault();

                            errorDiv.classList.add('hidden');
                            const originalText = btnText.textContent;
                            btnText.textContent = "Processando...";
                            btn.disabled = true;

                            const name = document.getElementById('name').value;
                            const cr = document.getElementById('cr').value;
                            const email = document.getElementById('email').value;
                            const password = document.getElementById('password').value;

                            try {
                                // 1. Sign Up (Auth)
                                const { data, error } = await supabase.auth.signUp({
                                    email: email,
                                    password: password
                                });

                                if (error) throw error;

                                // Auto-Login Fallback for "Session Expired" issue
                                let session = data.session;
                                if (!session && data.user) {
                                    const { data: loginData, error: loginError } = await supabase.auth.signInWithPassword({
                                        email,
                                        password
                                    });
                                    if (!loginError && loginData.session) {
                                        session = loginData.session;
                                    } else if (loginError && loginError.message.includes("Email not confirmed")) {
                                        throw new Error("Cadastro realizado! Por favor, verifique seu e-mail.");
                                    }
                                }

                                if (!session && !data.user) throw new Error("Erro ao criar conta.");

                                // 2. Store Metadata for Next Step
                                localStorage.setItem('temp_reg_name', name);
                                localStorage.setItem('temp_reg_cr', cr);
                                localStorage.setItem('temp_reg_email', email);

                                // 3. Redirect (only if session exists or we rely on page 2 handling it)
                                if (session) {
                                    window.location.href = 'Cadastro - Page 2 - Clinica.html';
                                } else {
                                    throw new Error("Cadastro realizado. Verifique seu e-mail para confirmar.");
                                }

                            } catch (err) {
                                console.error(err);
                                let msg = err.message;
                                if (msg.includes("already registered")) msg = "Este e-mail já¡ está¡ cadastrado.";
                                if (msg.includes("security purposes")) msg = "Muitas tentativas. Aguarde 30 segundos.";
                                errorDiv.textContent = msg;
                                errorDiv.classList.remove('hidden');
                                btnText.textContent = originalText;
                                btn.disabled = false;
                            }
                        });
                    </script>
                    <div class="border-t border-border-color/50 pt-6 text-center">
                        <p class="text-text-secondary text-sm">
                            Ao se cadastrar, vocáª concorda com nossos <a
                                class="text-primary hover:underline font-medium" href="#">Termos de Uso</a> e <a
                                class="text-primary hover:underline font-medium" href="#">Polá­tica de Privacidade</a>.
                        </p>
                    </div>
                </div>
                <div class="sm:hidden text-center mt-2">
                    <p class="text-text-main dark:text-white text-sm">
                        Já¡ possui uma conta? <a class="text-primary font-bold" href="#">Entrar</a>
                    </p>
                </div>
            </div>
        </main>
    </div>

</body>

</html>
