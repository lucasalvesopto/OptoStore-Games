<!DOCTYPE html>
<html class="light" lang="pt-BR">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>Nova Transaçáo - Gestáo Financeira</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&amp;display=swap"
    rel="stylesheet" />
  <link
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
    rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#13ecec",
            "background-light": "#f6f8f8",
            "background-dark": "#102222",
            "surface-light": "#ffffff",
            "surface-dark": "#1a2c2c",
          },
          fontFamily: {
            "display": ["Inter", "sans-serif"]
          },
          borderRadius: {
            "DEFAULT": "0.5rem",
            "lg": "1rem",
            "xl": "1.5rem",
            "full": "9999px"
          },
        },
      },
    }
  </script>
</head>

<body
  class="bg-background-light dark:bg-background-dark font-display text-slate-900 dark:text-slate-100 antialiased overflow-hidden">
  <div class="flex h-screen w-full">
    <!-- Sidebar -->
    <aside
      class="w-64 flex-shrink-0 border-r border-slate-200 dark:border-slate-800 bg-surface-light dark:bg-surface-dark flex flex-col transition-colors duration-200 hidden md:flex">
      <div class="p-6">
        <div class="flex items-center gap-3 mb-8">
          <div class="bg-primary/20 p-2 rounded-lg">
            <span class="material-symbols-outlined text-primary-dark dark:text-primary text-3xl">visibility</span>
          </div>
          <div class="flex flex-col">
            <h1 class="text-base font-bold leading-tight text-slate-900 dark:text-white">Pagina do Optometrista</h1>
            <span class="text-xs font-medium text-slate-500 dark:text-slate-400">Pro Admin</span>
          </div>
        </div>
        <div
          class="flex flex-col gap-3 p-3 rounded-xl bg-slate-50 dark:bg-slate-800/50 mb-6 border border-slate-100 dark:border-slate-700">
          <div class="flex gap-3 items-center">
            <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10 ring-2 ring-primary/20"
              id="sidebar-clinic-logo" data-alt="Clinic logo showing an abstract eye symbol"
              style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuC4BJtPUvZewU_Krp1QI84SkqsltswXTpXlOwS9HgWPxhTdWG9LxYOMSsZptM4Zc3fWMmOcCcOyFFzHTsGN0k3b9zgS-ahr2QmCPEdq5GbH9e7j4Q3uTP2aoQvTmZjmgl2YGYbUKNj4akWaC3DfB1QitER0bqu_iICaYCrYxu66Dwb9thCLDMHrlypm0NdpKA08ILyrMcCOVDJo1N4Inl5oW9lqh3cg4erKd4eWd2i7O62r3dR_y2UmlfXXjJsKNn1CovSRG8HGI7kH");'>
            </div>
            <div class="flex flex-col overflow-hidden">
              <h2 class="text-sm font-semibold truncate text-slate-900 dark:text-white">Clá­nica Visão
                Total</h2>
              <p class="text-xs text-slate-500 dark:text-slate-400 truncate" id="sidebar-clinic-social">Unidade Centro
              </p>
            </div>
          </div>
        </div>
        <nav class="flex flex-col gap-1">
          <a class="flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800 text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white transition-colors"
            href="Pagina - Dashboard.html">
            <span class="material-symbols-outlined">dashboard</span>
            <span class="text-sm font-semibold">Dashboard</span>
          </a>
          <a class="flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800 text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white transition-colors"
            href="Pagina - Pacientes.html">
            <span class="material-symbols-outlined">groups</span>
            <span class="text-sm font-medium">Pacientes</span>
          </a>
          <a class="flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800 text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white transition-colors"
            href="Pagina - Agenda.html">
            <span class="material-symbols-outlined">calendar_month</span>
            <span class="text-sm font-medium">Agenda</span>
          </a>
          <a class="flex items-center gap-3 px-3 py-2.5 rounded-lg bg-primary/10 text-slate-900 dark:text-white group"
            href="Pagina - Financeiro.html">
            <span class="material-symbols-outlined text-primary-dark dark:text-primary fill-1">payments</span>
            <span class="text-sm font-medium">Financeiro</span>
          </a>
        </nav>
      </div>
      <div class="mt-auto p-6 border-t border-slate-100 dark:border-slate-800">
        <a class="flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800 text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white transition-colors"
          href="Pagina - Configuracoes.html">
          <span class="material-symbols-outlined">settings</span>
          <span class="text-sm font-medium">Configurações</span>
        </a>
        <a class="flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/10 text-slate-600 dark:text-slate-400 hover:text-red-600 dark:hover:text-red-400 transition-colors mt-1"
          href="Login - Pagina Inicial.html">
          <span class="material-symbols-outlined">logout</span>
          <span class="text-sm font-medium">Sair</span>
        </a>
      </div>
    </aside>
    <!-- Main Content -->
    <div class="flex flex-col flex-1 h-full overflow-hidden relative">
      <!-- Top Navbar -->
      <header
        class="h-16 flex items-center justify-between px-6 py-3 bg-surface-light dark:bg-surface-dark border-b border-slate-200 dark:border-slate-800 shrink-0 z-20">
        <div class="flex items-center gap-4 lg:hidden">
          <button class="p-2 -ml-2 text-slate-600 dark:text-slate-300">
            <span class="material-symbols-outlined">menu</span>
          </button>
        </div>
        <!-- Search -->
        <div class="hidden md:flex flex-1 max-w-xl">
          <div class="relative w-full group">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <span class="material-symbols-outlined text-slate-400">search</span>
            </div>
            <input
              class="block w-full pl-10 pr-3 py-2 border-none rounded-xl bg-slate-100 dark:bg-slate-800 text-slate-900 dark:text-slate-100 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-primary/50 text-sm transition-all"
              placeholder="Buscar paciente, prontuá¡rio ou exame..." type="text" />
          </div>
        </div>
        <!-- Right Actions -->
        <div class="flex items-center gap-3 ml-auto">
          <button onclick="window.location.href='Cadastro Novo Paciente.html'"
            class="flex items-center justify-center size-10 rounded-xl bg-primary text-slate-900 font-bold shadow-lg shadow-primary/20 hover:brightness-105 transition-all">
            <span class="material-symbols-outlined">add</span>
          </button>
          <div class="h-6 w-px bg-slate-200 dark:bg-slate-700 mx-1"></div>
          <button
            class="relative p-2 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl transition-colors">
            <span class="material-symbols-outlined filled">notifications</span>
            <span
              class="absolute top-2 right-2 size-2 bg-red-500 rounded-full ring-2 ring-white dark:ring-surface-dark"></span>
          </button>
          <button
            class="p-2 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl transition-colors">
            <span class="material-symbols-outlined">chat</span>
          </button>
          <div class="flex items-center gap-3 pl-2 ml-2 border-l border-slate-200 dark:border-slate-700">
            <div class="text-right hidden sm:block">
              <p id="header-user-name" class="text-sm font-bold text-slate-900 dark:text-white">Carregando...</p>
              <p id="header-user-role" class="text-xs text-slate-500 dark:text-slate-400">...</p>
            </div>
            <div
              class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10 ring-2 ring-slate-100 dark:ring-slate-700 cursor-pointer"
              data-alt="Profile picture of Dr. Ricardo"
              style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuDNdoBP7xYbwl4VoXFp0I53c4thInGIwHjPk0g5Tx3P8gassLNTwpmshlsqZ51TmjuqTAig8exeHzyw36eAID3cBpFrQoYfY-hPXGpWmSgX3KO6gWmuMiJ6CS8K6xxntctWq54ki3b4So_dUePMTw38o_EivRTeTMyfwMLzuPote4HiVVdX_Zr3nsliMMJP3-Tqjt2VHMUZWU8t0toq0ANvHhgaRB3ShKS1kQ0QcOnx92ZgVNl7x9E-V1T-9eIvzWlerdlx2eLTDXvM");'>
            </div>
          </div>
        </div>
      </header>
      <div class="flex-1 overflow-y-auto p-8 scroll-smooth">
        <div class="max-w-4xl mx-auto flex flex-col gap-8">
          <div class="flex flex-col gap-4">
            <a class="flex items-center gap-2 text-slate-500 hover:text-primary transition-colors w-fit group" href="#">
              <span
                class="material-symbols-outlined text-[20px] group-hover:-translate-x-1 transition-transform">arrow_back</span>
              <span class="text-sm font-medium">Voltar para Visão Geral</span>
            </a>
            <div class="flex flex-col">
              <h1 class="text-3xl font-black tracking-tight text-slate-900 dark:text-white">Nova Transaçáo</h1>
              <p class="text-slate-500 dark:text-slate-400 max-w-2xl mt-1">Registre um novo pagamento, procedimento ou
                entrada financeira no sistema.</p>
            </div>
          </div>
          <div
            class="bg-surface-light dark:bg-surface-dark border border-slate-200 dark:border-slate-800 rounded-2xl shadow-sm overflow-hidden">
            <div class="p-8">
              <form id="transaction-form" class="flex flex-col gap-8">

                <!-- Type Selection -->
                <div class="flex flex-col gap-3">
                  <label class="text-sm font-bold text-slate-700 dark:text-slate-300">Tipo de Transação</label>
                  <div class="flex gap-4">
                    <label class="flex items-center gap-2 cursor-pointer">
                      <input type="radio" name="type" value="income"
                        class="w-5 h-5 text-emerald-500 focus:ring-emerald-500 border-gray-300" checked>
                      <span class="text-slate-700 dark:text-slate-300 font-medium">Entrada</span>
                    </label>
                    <label class="flex items-center gap-2 cursor-pointer">
                      <input type="radio" name="type" value="expense"
                        class="w-5 h-5 text-rose-500 focus:ring-rose-500 border-gray-300">
                      <span class="text-slate-700 dark:text-slate-300 font-medium">Saída</span>
                    </label>
                  </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <!-- Description -->
                  <div class="col-span-2">
                    <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2"
                      for="description">Descrição</label>
                    <input id="description" name="description" type="text" required
                      class="w-full px-4 py-3 rounded-xl border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-white placeholder-slate-400 focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all"
                      placeholder="Ex: Pagamento de Aluguel, Venda de Óculos..." />
                  </div>

                  <!-- Category -->
                  <div>
                    <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2"
                      for="category">Categoria</label>
                    <div class="relative">
                      <select id="category" name="category" required
                        class="w-full pl-4 pr-10 py-3 rounded-xl border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-white focus:ring-2 focus:ring-primary/50 focus:border-primary appearance-none cursor-pointer">
                        <option value="" disabled selected>Selecione...</option>
                        <option value="Vendas">Vendas</option>
                        <option value="Serviços">Serviços</option>
                        <option value="Aluguel">Aluguel</option>
                        <option value="Energia">Energia Elétrica</option>
                        <option value="Água">Água</option>
                        <option value="Internet">Internet / Telefone</option>
                        <option value="Fornecedores">Fornecedores</option>
                        <option value="Manutenção">Manutenção</option>
                        <option value="Salários">Salários</option>
                        <option value="Impostos">Impostos</option>
                        <option value="Marketing">Marketing</option>
                        <option value="Outros">Outros</option>
                      </select>
                      <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                        <span class="material-symbols-outlined text-slate-500">expand_more</span>
                      </div>
                    </div>
                  </div>

                  <!-- Payment Method -->
                  <div>
                    <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2"
                      for="payment_method">Caixa / Método</label>
                    <div class="relative">
                      <select id="payment_method" name="payment_method" required
                        class="w-full pl-4 pr-10 py-3 rounded-xl border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-white focus:ring-2 focus:ring-primary/50 focus:border-primary appearance-none cursor-pointer">
                        <option value="" disabled selected>Selecione...</option>
                        <option value="Dinheiro">Dinheiro (Caixa)</option>
                        <option value="Pix">Pix (Conta)</option>
                        <option value="Cartão de Crédito">Cartão de Crédito</option>
                        <option value="Cartão de Débito">Cartão de Débito</option>
                        <option value="Transferência">Transferência Bancária</option>
                      </select>
                      <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                        <span class="material-symbols-outlined text-slate-500">expand_more</span>
                      </div>
                    </div>
                  </div>

                  <!-- Value -->
                  <div>
                    <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2" for="amount">Valor
                      (R$)</label>
                    <input id="amount" name="amount" type="number" step="0.01" required
                      class="w-full px-4 py-3 rounded-xl border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-white font-bold placeholder-slate-400 focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all"
                      placeholder="0,00" />
                  </div>

                  <!-- Date -->
                  <div>
                    <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2"
                      for="date">Data</label>
                    <input id="date" name="date" type="date" required
                      class="w-full px-4 py-3 rounded-xl border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-white placeholder-slate-400 focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all" />
                  </div>
                </div>

                <hr class="border-slate-100 dark:border-slate-800" />

                <div class="flex justify-end gap-3">
                  <button type="button" onclick="window.history.back()"
                    class="px-6 py-3 rounded-xl border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 font-bold hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors">
                    Cancelar
                  </button>
                  <button type="submit"
                    class="px-8 py-3 rounded-xl bg-primary text-slate-900 font-bold shadow-lg shadow-primary/20 hover:brightness-105 transition-all flex items-center gap-2">
                    <span class="material-symbols-outlined">save</span>
                    Salvar Transação
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
  </div>
  </main>
  </div>

  <script type="module" src="./js/dashboard.js"></script>
  <script type="module">
    import { supabase } from './js/supabase-client.js';
    import { loadSidebar } from './js/sidebar-loader.js';

    loadSidebar();

    const form = document.getElementById('transaction-form');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const btn = form.querySelector('button[type="submit"]');
      const originalText = btn.innerHTML;
      btn.innerHTML = 'Sal vando...';
      btn.disabled = true;

      try {
        const { data: { session } } = await supabase.auth.getSession();
        if (!session) {
          window.location.href = 'Login - Pagina Inicial.html';
          return;
        }

        const { data: profile } = await supabase
          .from('profiles')
          .select('clinic_id')
          .eq('id', session.user.id)
          .single();

        if (!profile || !profile.clinic_id) {
          alert('Erro: Usuário sem clínica vinculada.');
          return;
        }

        const formData = new FormData(form);

        const transaction = {
          clinic_id: profile.clinic_id,
          description: formData.get('description'),
          amount: parseFloat(formData.get('amount')),
          type: formData.get('type'),
          category: formData.get('category'),
          payment_method: formData.get('payment_method'),
          date: formData.get('date'),
          status: 'paid' // Defaulting to paid for manual cash flow entries
        };

        const { error } = await supabase.from('transactions').insert([transaction]);

        if (error) throw error;

        alert('Transação registrada com sucesso!');
        window.location.href = 'Pagina - Financeiro.html';

      } catch (error) {
        console.error('Erro:', error);
        alert('Erro ao salvar transação: ' + error.message);
        btn.innerHTML = originalText;
        btn.disabled = false;
      }
    });

    // Set default date to today
    document.getElementById('date').valueAsDate = new Date();
  </script>
</body>

</html>