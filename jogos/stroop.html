<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Stroop - Cores</title>
    <style>
        body { background: #121212; color: #FFF; font-family: sans-serif; text-align: center; overflow: hidden; margin: 0; }
        .screen { display: none; height: 100vh; flex-direction: column; justify-content: center; align-items: center; }
        .screen.active { display: flex; }
        #word-display { font-size: 8rem; font-weight: bold; margin-bottom: 20px; }
        .btn { padding: 15px; font-size: 1.2rem; cursor: pointer; background: #2196F3; border: none; color: white; border-radius: 5px; margin: 10px; }
    </style>
</head>
<body>
    <div id="screen-home" class="screen active">
        <h1>üß† Desafio Stroop</h1>
        <p>Paciente: <span id="p-name">---</span></p>
        <p>Diga a COR da tinta, n√£o o que est√° escrito!</p>
        <button class="btn" onclick="startGame()">Iniciar</button>
        <button class="btn" style="background:#555" onclick="window.location.href='../index.html'">Voltar</button>
    </div>

    <div id="screen-game" class="screen">
        <div id="word-display">PREPARAR</div>
        <div id="score-hud" style="color:#888;">Acertos: 0 | Tempo: 0.0s</div>
        <div style="position:fixed; bottom:10px; color:#555;">Seta Dir: Acertou | Seta Esq: Errou | ESC: Sair</div>
    </div>

    <script>
        const state = { patient: "", hits: 0, total: 0, startTime: 0, roundStart: 0, times: [] };
        const COLORS = [
            {name: "VERMELHO", hex: "#FF0000"},
            {name: "AZUL", hex: "#0000FF"},
            {name: "VERDE", hex: "#00FF00"},
            {name: "AMARELO", hex: "#FFFF00"},
            {name: "ROXO", hex: "#E040FB"}
        ];

        window.onload = () => { state.patient = new URLSearchParams(window.location.search).get('paciente') || "Visitante"; document.getElementById('p-name').innerText = state.patient; };

        function startGame() {
            document.getElementById('screen-home').classList.remove('active');
            document.getElementById('screen-game').classList.add('active');
            state.hits = 0; state.total = 0; state.times = [];
            nextRound();
        }

        function nextRound() {
            // Escolhe palavra e cor conflitantes
            const textObj = COLORS[Math.floor(Math.random() * COLORS.length)];
            let inkObj = COLORS[Math.floor(Math.random() * COLORS.length)];
            
            // 70% de chance de conflito, 30% de chance de ser igual (para confundir)
            if(Math.random() < 0.7) {
                while(inkObj === textObj) inkObj = COLORS[Math.floor(Math.random() * COLORS.length)];
            } else {
                inkObj = textObj;
            }

            const el = document.getElementById('word-display');
            el.innerText = textObj.name;
            el.style.color = inkObj.hex;
            
            state.roundStart = Date.now();
        }

        window.addEventListener('keydown', (e) => {
            if(e.key === 'ArrowRight' || e.key === 'ArrowLeft') {
                const time = (Date.now() - state.roundStart) / 1000;
                state.times.push(time);
                state.total++;
                if(e.key === 'ArrowRight') state.hits++;
                
                document.getElementById('score-hud').innerText = `Acertos: ${state.hits}/${state.total} | M√©dia: ${(state.times.reduce((a,b)=>a+b,0)/state.total).toFixed(2)}s`;
                nextRound();
            }
            if(e.key === 'Escape') {
                alert(`Fim! Acertos: ${state.hits}/${state.total}`);
                window.location.href = '../index.html';
            }
        });
    </script>
</body>
</html>