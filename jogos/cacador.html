<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>O Ca√ßador de S√≠mbolos</title>
    <style>
        body { background: #121212; color: #FFF; font-family: sans-serif; text-align: center; overflow: hidden; margin: 0; }
        .screen { display: none; height: 100vh; flex-direction: column; justify-content: center; align-items: center; }
        .screen.active { display: flex; }
        
        #game-header { position: absolute; top: 10px; width: 100%; font-size: 1.5rem; }
        #target-desc { color: #00E5FF; font-weight: bold; font-size: 2rem; }
        
        #grid { display: grid; gap: 10px; margin-top: 50px; padding: 10px; background: #222; border-radius: 10px; }
        .cell { width: 60px; height: 60px; display: flex; justify-content: center; align-items: center; font-size: 2.5rem; border: 3px solid transparent; border-radius: 5px; cursor: pointer; }
        .cell.selected { border-color: #00E676; background: #333; box-shadow: 0 0 15px #00E676; }
        
        .btn { padding: 10px 20px; font-size: 1.2rem; cursor: pointer; background: #FF9800; border: none; border-radius: 5px; margin: 10px; }
    </style>
</head>
<body>
    <div id="screen-home" class="screen active">
        <h1>üîç O Ca√ßador</h1>
        <p>Paciente: <span id="p-name">---</span></p>
        <p>Encontre o objeto solicitado o mais r√°pido poss√≠vel.</p>
        <button class="btn" onclick="startGame()">Iniciar</button>
        <button class="btn" style="background:#555; color:white" onclick="window.location.href='../index.html'">Voltar</button>
    </div>

    <div id="screen-game" class="screen">
        <div id="game-header">ENCONTRE: <span id="target-desc">...</span></div>
        <div id="grid"></div>
        <div style="position:fixed; bottom:10px; color:#888;">Setas: Navegar | ENTER: Confirmar</div>
    </div>

    <script>
        const state = { patient: "", target: null, items: [], cursor: 0, startTime: 0, rows: 6, cols: 8 };
        const SHAPES = ["‚óè", "‚ñ†", "‚ñ≤", "‚òÖ", "‚ô¶"];
        const COLORS = [
            {n:"Vermelho", c:"#FF5252"}, {n:"Azul", c:"#448AFF"}, {n:"Verde", c:"#69F0AE"}, {n:"Amarelo", c:"#FFFF00"}
        ];

        window.onload = () => { state.patient = new URLSearchParams(window.location.search).get('paciente') || "Visitante"; document.getElementById('p-name').innerText = state.patient; };

        function startGame() {
            document.getElementById('screen-home').classList.remove('active');
            document.getElementById('screen-game').classList.add('active');
            nextRound();
        }

        function nextRound() {
            const grid = document.getElementById('grid');
            grid.innerHTML = "";
            grid.style.gridTemplateColumns = `repeat(${state.cols}, 1fr)`;
            
            state.items = [];
            state.cursor = 0;
            
            // Gera itens
            for(let i=0; i<state.rows*state.cols; i++) {
                const shape = SHAPES[Math.floor(Math.random() * SHAPES.length)];
                const color = COLORS[Math.floor(Math.random() * COLORS.length)];
                state.items.push({ shape, color, id: i });
            }
            
            // Escolhe alvo
            state.target = state.items[Math.floor(Math.random() * state.items.length)];
            document.getElementById('target-desc').innerText = `${state.target.shape} ${state.target.color.n}`;
            document.getElementById('target-desc').style.color = state.target.color.c;

            // Renderiza
            state.items.forEach((item, i) => {
                const el = document.createElement('div');
                el.className = 'cell';
                el.id = 'c-'+i;
                el.innerText = item.shape;
                el.style.color = item.color.c;
                grid.appendChild(el);
            });
            
            updateCursor();
            state.startTime = Date.now();
        }

        function updateCursor() {
            document.querySelectorAll('.cell').forEach(c => c.classList.remove('selected'));
            document.getElementById('c-'+state.cursor).classList.add('selected');
        }

        window.addEventListener('keydown', (e) => {
            const max = state.rows * state.cols;
            if(e.key === 'ArrowRight') state.cursor = (state.cursor + 1) % max;
            if(e.key === 'ArrowLeft') state.cursor = (state.cursor - 1 + max) % max;
            if(e.key === 'ArrowDown') state.cursor = (state.cursor + state.cols) % max;
            if(e.key === 'ArrowUp') state.cursor = (state.cursor - state.cols + max) % max;
            
            if(e.key === 'Enter') {
                const selected = state.items[state.cursor];
                if(selected === state.target) {
                    const time = ((Date.now() - state.startTime)/1000).toFixed(1);
                    saveResult(time);
                    alert(`ACHOU! Tempo: ${time}s`);
                    nextRound();
                } else {
                    // Feedback visual de erro
                    document.getElementById('c-'+state.cursor).style.backgroundColor = "red";
                    setTimeout(() => document.getElementById('c-'+state.cursor).style.backgroundColor = "transparent", 200);
                }
            }
            updateCursor();
            if(e.key === 'Escape') window.location.href='../index.html';
        });

        function saveResult(time) {
            let h = JSON.parse(localStorage.getItem('neuro_opt_cacador_history') || '[]');
            h.unshift({ date: new Date().toLocaleString(), patient: state.patient, time: time + 's' });
            localStorage.setItem('neuro_opt_cacador_history', JSON.stringify(h));
        }
    </script>
</body>
</html>